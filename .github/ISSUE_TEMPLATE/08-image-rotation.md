---
name: ç”»åƒå›è»¢æ©Ÿèƒ½
about: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸç”»åƒã‚’90åº¦ãšã¤å›è»¢å¯èƒ½ã«
title: 'ğŸ”„ ç”»åƒå›è»¢æ©Ÿèƒ½ã®å®Ÿè£…'
labels: 'enhancement, priority-low, ui/ux'
assignees: ''
---

## ğŸ“‹ è¦ä»¶

- [ ] å›è»¢ãƒœã‚¿ãƒ³ã®è¿½åŠ ï¼ˆ90åº¦ãšã¤ï¼‰
- [ ] ç”»åƒã®å›è»¢çŠ¶æ…‹ã‚’ä¿æŒ
- [ ] å›è»¢å¾Œã®ç”»åƒä¿å­˜
- [ ] ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³æ’®å½±ç”»åƒã¸ã®å¯¾å¿œ
- [ ] EXIFæƒ…å ±ã®è‡ªå‹•ä¿®æ­£

## ğŸ› ï¸ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- TypeScript
- Canvas API
- sharpï¼ˆNode.jsç”»åƒå‡¦ç†ï¼‰
- piexifjsï¼ˆEXIFå‡¦ç†ï¼‰

## ğŸ“ èª¬æ˜

ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§æ’®å½±ã—ãŸç”»åƒãŒæ¨ªå‘ãã«ãªã£ã¦ã—ã¾ã†å•é¡Œã‚„ã€é–“é•ã£ãŸå‘ãã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸç”»åƒã‚’ç°¡å˜ã«ä¿®æ­£ã§ãã‚‹ã‚ˆã†ã€å›è»¢æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

### ç¾åœ¨ã®å•é¡Œ

- ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³æ’®å½±ç”»åƒãŒ90åº¦å›è»¢ã—ã¦ã„ã‚‹
- é–“é•ã£ãŸå‘ãã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸå ´åˆã€å†ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒå¿…è¦
- EXIFæƒ…å ±ã«ã‚ˆã‚‹è‡ªå‹•å›è»¢ã«éå¯¾å¿œ

### æ”¹å–„å¾Œã®å‹•ä½œ

```
[â†» 90Â°] ãƒœã‚¿ãƒ³ â†’ æ™‚è¨ˆå›ã‚Šã«90åº¦å›è»¢
[â†º -90Â°] ãƒœã‚¿ãƒ³ â†’ åæ™‚è¨ˆå›ã‚Šã«90åº¦å›è»¢
[ä¿å­˜] ãƒœã‚¿ãƒ³ â†’ å›è»¢çŠ¶æ…‹ã‚’ä¿å­˜
```

## ğŸ“Š UIãƒ‡ã‚¶ã‚¤ãƒ³

### ç”»åƒãƒ“ãƒ¥ãƒ¼ã‚¢ï¼ˆå³ãƒ‘ãƒãƒ«ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‹¡å¤§ ç¸®å° ãƒªã‚»ãƒƒãƒˆ â†» â†º ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             â”‚
â”‚     ç”»åƒï¼ˆå›è»¢å¯èƒ½ï¼‰         â”‚
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«

- **â†»**: æ™‚è¨ˆå›ã‚Šã«90åº¦å›è»¢
- **â†º**: åæ™‚è¨ˆå›ã‚Šã«90åº¦å›è»¢
- å›è»¢çŠ¶æ…‹ã¯ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
- ã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ã§ç¢ºå®š

## ğŸ“Š æˆåŠŸæ¡ä»¶

- [ ] 90åº¦ãšã¤å›è»¢ã§ãã‚‹
- [ ] å›è»¢çŠ¶æ…‹ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«åæ˜ 
- [ ] ä¿å­˜å¾Œã‚‚å›è»¢çŠ¶æ…‹ãŒç¶­æŒ
- [ ] EXIFæƒ…å ±ãŒæ­£ã—ãæ›´æ–°ã•ã‚Œã‚‹
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è‰¯å¥½

## ğŸ”— é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

- `app/(admin)/admin/applications/[employeeId]/page.tsx` - è©³ç´°ç”»é¢
- `app/api/files/[fileKey]/rotate/route.ts` - ç”»åƒå›è»¢APIï¼ˆæ–°è¦ï¼‰
- `lib/image-utils.ts` - ç”»åƒå‡¦ç†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆæ–°è¦ï¼‰

## ğŸ¯ å®Ÿè£…æ–¹é‡

### 1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: CSSã«ã‚ˆã‚‹å›è»¢ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼

```typescript
const [rotation, setRotation] = useState(0);

const rotate = (degrees: number) => {
  setRotation((prev) => (prev + degrees) % 360);
};

<img
  src={imageUrl}
  style={{ transform: `rotate(${rotation}deg)` }}
  alt="Document"
/>

<button onClick={() => rotate(90)}>â†» 90Â°</button>
<button onClick={() => rotate(-90)}>â†º -90Â°</button>
```

### 2. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: ç”»åƒã®å®Ÿéš›ã®å›è»¢

```typescript
// app/api/files/[fileKey]/rotate/route.ts
import sharp from "sharp";

export async function POST(request: NextRequest, { params }) {
  const { fileKey } = params;
  const { rotation } = await request.json(); // 90, 180, 270

  // Larkã‹ã‚‰ç”»åƒã‚’å–å¾—
  const fileBuffer = await downloadFileFromLark(fileKey);

  // sharpã§å›è»¢
  const rotatedBuffer = await sharp(fileBuffer)
    .rotate(rotation)
    .toBuffer();

  // Larkã«å†ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
  const newFileKey = await uploadFileToLark(rotatedBuffer, "rotated.jpg");

  // Lark Baseã®image_urlã‚’æ›´æ–°
  await updateFileKey(recordId, newFileKey);

  return NextResponse.json({ success: true, newFileKey });
}
```

### 3. EXIFæƒ…å ±ã®å‡¦ç†

```typescript
import piexif from "piexifjs";

// EXIF Orientationã‚¿ã‚°ã‚’èª­ã¿å–ã‚Š
const exif = piexif.load(imageDataURL);
const orientation = exif["0th"][piexif.ImageIFD.Orientation];

// è‡ªå‹•å›è»¢
if (orientation === 6) {
  // 90åº¦å›è»¢ãŒå¿…è¦
  rotate(90);
} else if (orientation === 8) {
  // -90åº¦å›è»¢ãŒå¿…è¦
  rotate(-90);
}
```

## ğŸ“š ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install sharp piexifjs
npm install -D @types/sharp
```

## ğŸ”„ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### ã‚±ãƒ¼ã‚¹1: ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³æ’®å½±ç”»åƒ

1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§æ’®å½±ã—ãŸç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
2. EXIFæƒ…å ±ã‚’èª­ã¿å–ã‚Šã€è‡ªå‹•ã§æ­£ã—ã„å‘ãã«å›è»¢
3. ç®¡ç†è€…ã¯æ­£ã—ã„å‘ãã§ç¢ºèªã§ãã‚‹

### ã‚±ãƒ¼ã‚¹2: æ‰‹å‹•å›è»¢

1. ç®¡ç†è€…ãŒè©³ç´°ç”»é¢ã§ç”»åƒã‚’ç¢ºèª
2. å‘ããŒé–“é•ã£ã¦ã„ã‚‹ã“ã¨ã«æ°—ã¥ã
3. ã€Œâ†» 90Â°ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ç¢ºèª
5. ã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ã§ç¢ºå®š

## âš ï¸ æ³¨æ„äº‹é …

| é …ç›® | å†…å®¹ |
|------|------|
| ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ | å¤§ããªç”»åƒã®å›è»¢ã«ã¯æ™‚é–“ãŒã‹ã‹ã‚‹ |
| ç”»è³ªåŠ£åŒ– | JPEGã®å†ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã§ç”»è³ªãŒåŠ£åŒ–ã™ã‚‹å¯èƒ½æ€§ |
| EXIFæƒ…å ± | å›è»¢å¾Œã«EXIF Orientationã‚’1ï¼ˆNormalï¼‰ã«è¨­å®š |

---

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)
