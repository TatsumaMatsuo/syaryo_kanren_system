# 車両関連管理システム 要件定義書

## 概要
社員のマイカー通勤申請、車両情報管理、有効期限管理を行うWebアプリケーション

## システム要件

### 技術スタック
- **データ管理**: Lark Base
- **プラットフォーム**: Webアプリケーション（モバイル対応）
- **アクセス**: PC・携帯端末の両方から入力可能

### データ構造
以下の3つのテーブルで管理:
1. **免許証データテーブル**
2. **車検証データテーブル**
3. **任意保険証データテーブル**

各テーブルには以下の共通項目を含む:
- 社員ID（結合キー）
- ステータス（仮/本）
- 有効期限
- 削除フラグ
- アップロードファイル（画像）
- 必要事項（各証明書固有の情報）

### データ表示
- 管理者画面: 3つのテーブルを社員IDで内部結合し、統合ビューで表示
- 削除フラグのついたデータは表示・通知対象外

---

## 機能要件

### 1. 入社時のマイカー通勤申請フロー

#### 1.1 申請者の操作
1. **免許証の申請**
   - 免許証写真をアップロード
   - 必要事項を入力
   - 申請送信

2. **車検証の申請**
   - 車検証写真をアップロード
   - 必要事項を入力（有効期限を含む）
   - 申請送信

3. **任意保険証の申請**
   - 任意保険証写真をアップロード
   - 必要事項を入力（有効期限を含む）
   - 申請送信

#### 1.2 管理者の操作
1. **一覧確認**
   - 免許証、車検証、任意保険証のデータと画像を統合ビューで確認

2. **承認/却下判断**
   - **NG の場合**:
     - NG理由を入力
     - 申請者へチャットで通知
     - ステータスは「仮」のまま

   - **OK の場合**:
     - 承認処理を実行
     - ステータスを「仮」→「本」に変更
     - 申請者へ承認通知
     - 許可証発行機能を有効化

---

### 2. 有効期限管理フロー

#### 2.1 有効期限切れ前の通知
- **対象**: 免許証、車検証、任意保険証
- **通知タイミング**: 有効期限の1週間前
- **通知先**: 申請者本人
- **通知内容**: 更新が必要な証明書の種類と期限日

#### 2.2 有効期限切れ時の処理
- **有効期限が切れた場合**:
  - 申請者に通知
  - **管理者にも通知**
  - ステータスを更新（期限切れフラグ等）

#### 2.3 更新手続き
1. **申請者の操作**
   - 該当する入力フォームにアクセス
   - 入社時と同様に、新しい証明書をアップロード
   - 必要事項を入力して申請

2. **管理者の操作**
   - 更新内容を確認
   - 入社時と同様のOK/NGフローで判断

---

### 3. 退職時の処理

#### 3.1 論理削除
- 退職した社員のデータには**削除フラグ**を設定
- 物理削除は行わない（履歴保持のため）

#### 3.2 削除フラグの影響
削除フラグがついたデータは以下から除外:
- 一覧表示
- 検索結果
- 有効期限アラート通知
- 統計・レポート

---

## 非機能要件

### セキュリティ
- 個人情報（免許証、車検証等）の安全な保管
- アクセス権限管理（申請者/管理者の分離）
- ファイルアップロードのセキュリティ対策

### ユーザビリティ
- モバイル端末でも使いやすいレスポンシブデザイン
- 直感的なUI/UX
- 申請状況の可視化

### 通知機能
- チャット通知システム（承認/却下時）
- メール通知（有効期限アラート）
- リアルタイム性の確保

### パフォーマンス
- 画像アップロードの高速化
- 大量データでも快適な一覧表示

---

## 画面構成（案）

### 申請者画面
1. ダッシュボード（申請状況一覧）
2. 免許証申請フォーム
3. 車検証申請フォーム
4. 任意保険証申請フォーム
5. 許可証表示画面

### 管理者画面
1. 申請一覧（統合ビュー）
2. 申請詳細・承認画面
3. 有効期限管理画面
4. 社員マスタ管理

---

## 今後の検討事項
- Lark Baseとの具体的な連携方法
- チャット通知の実装方式（Lark Messenger連携等）
- 許可証のフォーマット・発行方法
- 承認ワークフローの詳細設計
- バックアップ・リカバリ戦略
